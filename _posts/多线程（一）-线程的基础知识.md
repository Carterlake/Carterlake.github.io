## 多线程（1）——线程的基础知识

#### 线程与进程

**进程是资源分配的最小单位，线程是CPU调度的最小单位**

+ ##### 进程

总的来说，进程功能侧重于对资源的管理，

这个资源包括cpu，内存，打开的文件，映射的网络端口

每个进程管理的内存互不重叠，互不干扰

不同进程间的数据很难共享

+ ##### 线程

线程是进程中的一个运行单元

他负责指挥cpu的具体执行和调度

一个进程至少有一个线程。并由这个线程控制进程的执行。

JVM启动时会启动一个进程java.exe，负责此进程执行的线程存在于main函数中，称为主线程

一个进程中可以拥有多个线程，同一进程中的线程共用一片资源

这也使得进程中各线程信息的交流十分便捷



#### 线程运行中的状态

+ ##### 新建

  线程在刚被创建之后处于的状态，此时线程只被分配了内存

+ ##### 等待

  新建之后，调用start方法前处于的状态

+ ##### 就绪

  当调用此线程的start方法后，进入就绪状态，此线程进入线程池中，等待cpu的调用

+ ##### 运行

  cpu调用此线程并执行代码，单个cpu中只会有一个线程处于运行状态

  运行状态只能由就绪状态切换过来

+ ##### 阻塞

  线程暂停运行，不在占用CPU资源，阻塞状态会过渡到就绪状态，然后重新运行

  阻塞状态分为三种：

  + ###### 等待阻塞

    线程执行wait方法，进入等待状态，直到被调用start重新进入就绪

  + ###### 同步阻塞

    运行的线程若获取具有同步锁且被别的线程占用的数据时进入阻塞

  + ###### 其他阻塞

      线程执行sleep方法或者进行I/O请求，当方法或请求执行完毕，线程进入就绪状态

+ ##### 死亡

  线程执行完了需要执行的代码或者遇到了未被捕获的错误被系统强行杀死，结束其生命周期


#### 线程控制模块

我们每次新建一个线程的时候，JVM会在内存中生成一个新的私有的线程控制块

包括 PC寄存器， java栈 ，native栈

* PC计数器：记录正在执行的代码的虚拟机字节码地址

* java栈：方法执行的内存区

* Native栈：存放本地语言方法的调用信息，当java程序通过JNL调用native方法时，

  根据本地语言建立相应的栈


#### 多线程运行的原理

线程的运行是线性的，任务只能按照设定的顺序一项一项执行

但是可以在一个进程中开多个线程，在不同的线程中执行不同的任务

这样就可以“同时”执行多个任务

cpu处理采用的是分段切换执行线程的方式

单核cpu在一个时刻只能执行一个线程

由于cpu切换线程的速度非常快，才让人感觉是很多个程序能同时执行

但是这样就会存在很多个线程同时等待执行的情况

每一个线程都在向cpu申请执行，可以说多线程的运行是在对cpu “争宠”

##### 缺点

新的线程会占用更多的内存空间，过多的线程会占据过多的内存，降低性能

cpu在调度，切换线程是会消耗cpu资源的

另外太多线程同时运行，会降低运行单个线程的频率和单次运行持续时间

另外线程直接的数据共享和通讯会更加的复杂